{
  "version": 3,
  "sources": ["src/app/features/home/presentation/state/home-state.service.ts"],
  "sourcesContent": ["import { Injectable, computed, signal } from '@angular/core';\nimport { Product } from '../../../product/data/models/product-response.model';\nimport { CartItem } from '../../data/models/home-response.model';\n\n/**\n * Cart State Service — manages the shopping cart using Angular Signals.\n * Provided at root so cart persists across navigation.\n */\n@Injectable({ providedIn: 'root' })\nexport class HomeStateService {\n  /** Internal cart items list */\n  readonly cartItems = signal<CartItem[]>([]);\n\n  /** Total quantity of items in the cart */\n  readonly cartCount = computed(() =>\n    this.cartItems().reduce((sum, item) => sum + item.quantity, 0)\n  );\n\n  /** Total price of all items in the cart */\n  readonly cartTotal = computed(() =>\n    this.cartItems().reduce((sum, item) => sum + item.totalPrice, 0)\n  );\n\n  /**\n   * Add a product to the cart (or increase qty if already present).\n   * Throws if requested qty exceeds available stock.\n   */\n  addToCart(product: Product, quantity: number): void {\n    const existing = this.cartItems().find((i) => i.product.id === product.id);\n    const currentQty = existing ? existing.quantity : 0;\n    const newQty = currentQty + quantity;\n\n    if (newQty > product.stockQuantity) {\n      throw new Error(\n        `Cannot add ${quantity} — only ${product.stockQuantity - currentQty} left in stock.`\n      );\n    }\n\n    if (existing) {\n      this.cartItems.update((items) =>\n        items.map((i) =>\n          i.product.id === product.id\n            ? { ...i, quantity: newQty, totalPrice: newQty * i.product.price }\n            : i\n        )\n      );\n    } else {\n      this.cartItems.update((items) => [\n        ...items,\n        { product, quantity, totalPrice: quantity * product.price },\n      ]);\n    }\n  }\n\n  /**\n   * Set the quantity for an item already in the cart.\n   * If newQuantity is 0, the item is removed.\n   */\n  updateQuantity(productId: string, newQuantity: number): void {\n    if (newQuantity <= 0) {\n      this.cartItems.update((items) => items.filter((i) => i.product.id !== productId));\n      return;\n    }\n\n    const item = this.cartItems().find((i) => i.product.id === productId);\n    if (!item) return;\n\n    if (newQuantity > item.product.stockQuantity) {\n      throw new Error(`Cannot exceed stock limit (${item.product.stockQuantity}).`);\n    }\n\n    this.cartItems.update((items) =>\n      items.map((i) =>\n        i.product.id === productId\n          ? { ...i, quantity: newQuantity, totalPrice: newQuantity * i.product.price }\n          : i\n      )\n    );\n  }\n\n  /** Returns the current quantity of a specific product in the cart. */\n  getQuantityInCart(productId: string): number {\n    return this.cartItems().find((i) => i.product.id === productId)?.quantity ?? 0;\n  }\n\n  /** Remove a specific item from the cart by product ID. */\n  removeFromCart(productId: string): void {\n    this.cartItems.update((items) => items.filter((i) => i.product.id !== productId));\n  }\n\n  /** Clear all items from the cart. */\n  clearCart(): void {\n    this.cartItems.set([]);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;AASM,IAAO,mBAAP,MAAO,kBAAgB;;EAElB,YAAY,OAAmB,CAAA,GAAE,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;;EAGjC,YAAY,SAAS,MAC5B,KAAK,UAAS,EAAG,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,UAAU,CAAC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;;EAIvD,YAAY,SAAS,MAC5B,KAAK,UAAS,EAAG,OAAO,CAAC,KAAK,SAAS,MAAM,KAAK,YAAY,CAAC,GAAC,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;;;;;EAOlE,UAAU,SAAkB,UAAgB;AAC1C,UAAM,WAAW,KAAK,UAAS,EAAG,KAAK,CAAC,MAAM,EAAE,QAAQ,OAAO,QAAQ,EAAE;AACzE,UAAM,aAAa,WAAW,SAAS,WAAW;AAClD,UAAM,SAAS,aAAa;AAE5B,QAAI,SAAS,QAAQ,eAAe;AAClC,YAAM,IAAI,MACR,cAAc,QAAQ,gBAAW,QAAQ,gBAAgB,UAAU,iBAAiB;IAExF;AAEA,QAAI,UAAU;AACZ,WAAK,UAAU,OAAO,CAAC,UACrB,MAAM,IAAI,CAAC,MACT,EAAE,QAAQ,OAAO,QAAQ,KACrB,iCAAK,IAAL,EAAQ,UAAU,QAAQ,YAAY,SAAS,EAAE,QAAQ,MAAK,KAC9D,CAAC,CACN;IAEL,OAAO;AACL,WAAK,UAAU,OAAO,CAAC,UAAU;QAC/B,GAAG;QACH,EAAE,SAAS,UAAU,YAAY,WAAW,QAAQ,MAAK;OAC1D;IACH;EACF;;;;;EAMA,eAAe,WAAmB,aAAmB;AACnD,QAAI,eAAe,GAAG;AACpB,WAAK,UAAU,OAAO,CAAC,UAAU,MAAM,OAAO,CAAC,MAAM,EAAE,QAAQ,OAAO,SAAS,CAAC;AAChF;IACF;AAEA,UAAM,OAAO,KAAK,UAAS,EAAG,KAAK,CAAC,MAAM,EAAE,QAAQ,OAAO,SAAS;AACpE,QAAI,CAAC;AAAM;AAEX,QAAI,cAAc,KAAK,QAAQ,eAAe;AAC5C,YAAM,IAAI,MAAM,8BAA8B,KAAK,QAAQ,aAAa,IAAI;IAC9E;AAEA,SAAK,UAAU,OAAO,CAAC,UACrB,MAAM,IAAI,CAAC,MACT,EAAE,QAAQ,OAAO,YACb,iCAAK,IAAL,EAAQ,UAAU,aAAa,YAAY,cAAc,EAAE,QAAQ,MAAK,KACxE,CAAC,CACN;EAEL;;EAGA,kBAAkB,WAAiB;AACjC,WAAO,KAAK,UAAS,EAAG,KAAK,CAAC,MAAM,EAAE,QAAQ,OAAO,SAAS,GAAG,YAAY;EAC/E;;EAGA,eAAe,WAAiB;AAC9B,SAAK,UAAU,OAAO,CAAC,UAAU,MAAM,OAAO,CAAC,MAAM,EAAE,QAAQ,OAAO,SAAS,CAAC;EAClF;;EAGA,YAAS;AACP,SAAK,UAAU,IAAI,CAAA,CAAE;EACvB;;qCApFW,mBAAgB;EAAA;4EAAhB,mBAAgB,SAAhB,kBAAgB,WAAA,YADH,OAAM,CAAA;;;sEACnB,kBAAgB,CAAA;UAD5B;WAAW,EAAE,YAAY,OAAM,CAAE;;;",
  "names": []
}
