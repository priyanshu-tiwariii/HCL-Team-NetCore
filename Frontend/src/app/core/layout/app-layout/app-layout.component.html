<div class="flex h-screen w-full overflow-hidden bg-zinc-50">
  <!-- ═══════════════ SIDEBAR ═══════════════ -->
  <aside
    class="flex flex-col shrink-0 bg-zinc-50 border-r px-2 border-zinc-200 overflow-hidden transition-[width,min-width] duration-220 ease-in-out z-20"
    [class.w-64]="!layout.isSidebarCollapsed()"
    [class.min-w-64]="!layout.isSidebarCollapsed()"
    [class.w-16]="layout.isSidebarCollapsed()"
    [class.min-w-16]="layout.isSidebarCollapsed()"
  >
    <!-- ── Sidebar Header ── -->
    <div
      class="h-16 flex items-center shrink-0 border-b border-zinc-200 gap-2"
      [class.justify-between]="!layout.isSidebarCollapsed()"
      [class.px-4]="!layout.isSidebarCollapsed()"
      [class.justify-center]="layout.isSidebarCollapsed()"
    >
      @if (!layout.isSidebarCollapsed()) {
        <div class="flex items-center gap-2.5 flex-1 min-w-0 overflow-hidden">
          <div
            class="flex items-center justify-center size-8 min-w-8 rounded-lg bg-zinc-900 text-white font-bold text-sm select-none shrink-0"
          >
            F
          </div>
          <span
            class="text-sm font-semibold text-zinc-900 tracking-tight whitespace-nowrap overflow-hidden text-ellipsis"
          >
            Food Retail
          </span>
        </div>
      }

      <!-- Toggle — no tooltip, distinct icon -->
      <button
        class="flex items-center justify-center size-8 rounded-md border border-zinc-200 text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100 transition-colors duration-150 shrink-0"
        (click)="layout.toggleSidebar()"
        aria-label="Toggle sidebar"
      >
        <i
          class="pi"
          [class.pi-angle-left]="!layout.isSidebarCollapsed()"
          [class.pi-angle-right]="layout.isSidebarCollapsed()"
          class="text-[16px]"
        ></i>
      </button>
    </div>

    <!-- ── Navigation ── -->
    <nav
      aria-label="Main navigation"
      class="flex-1 overflow-y-auto overflow-x-hidden py-3 flex flex-col gap-0.5 sidebar-nav"
      [class.px-2.5]="!layout.isSidebarCollapsed()"
      [class.px-2]="layout.isSidebarCollapsed()"
      [class.items-center]="layout.isSidebarCollapsed()"
    >
      @for (item of navItems; track $index) {
        @if (item.separator) {
          <div class="h-px bg-zinc-100 my-1.5 mx-0.5"></div>
        } @else if (item.items) {
          @if (!layout.isSidebarCollapsed()) {
            <!-- Expanded group -->
            <div class="flex flex-col gap-0.5 mt-2">
              <button
                class="w-full flex items-center gap-2.5 px-2.5 py-1.5 rounded-md text-[13.5px] font-medium border-none cursor-pointer text-left transition-colors duration-150 relative overflow-hidden"
                [ngClass]="
                  isGroupActive(item)
                    ? 'text-zinc-900 font-semibold bg-transparent hover:bg-zinc-100'
                    : 'text-zinc-600 bg-transparent hover:bg-zinc-100 hover:text-zinc-900'
                "
                (click)="toggleGroup(item.label!)"
                pRipple
              >
                <i [class]="item.icon" class="text-[15px] w-4.5 text-center shrink-0"></i>
                <span class="flex-1 overflow-hidden text-ellipsis">{{ item.label }}</span>
                <i
                  class="pi text-[10px] shrink-0 text-zinc-400"
                  [class.pi-chevron-down]="!isGroupOpen(item.label!)"
                  [class.pi-chevron-up]="isGroupOpen(item.label!)"
                ></i>
              </button>

              @if (isGroupOpen(item.label!)) {
                <div class="flex flex-col gap-0.5 mt-0.5 pl-3.5 border-l border-zinc-200 ml-4.5">
                  @for (child of item.items; track $index) {
                    <button
                      class="w-full flex items-center gap-2.5 px-2.5 py-1.5 rounded-md text-[13px] font-normal border-none cursor-pointer text-left transition-colors duration-150 relative overflow-hidden"
                      [ngClass]="
                        isItemActive(child)
                          ? 'bg-zinc-200 text-zinc-900 font-medium hover:bg-zinc-200'
                          : 'text-zinc-500 bg-transparent hover:bg-zinc-100 hover:text-zinc-900'
                      "
                      (click)="navigate(child)"
                      pRipple
                    >
                      <i [class]="child.icon" class="text-[13px] w-4 text-center shrink-0"></i>
                      <span class="flex-1 overflow-hidden text-ellipsis">{{ child.label }}</span>
                    </button>
                  }
                </div>
              }
            </div>
          } @else {
            <!-- Collapsed group — icon + tooltip -->
            <div class="flex justify-center w-full" [pTooltip]="item.label" tooltipPosition="right">
              <button
                class="flex items-center justify-center size-10 rounded-md border-none cursor-pointer transition-colors duration-150 relative overflow-hidden"
                [ngClass]="
                  isGroupActive(item)
                    ? 'bg-zinc-100 text-zinc-900 hover:bg-zinc-200'
                    : 'bg-transparent text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900'
                "
                (click)="toggleGroup(item.label!)"
                pRipple
              >
                <i [class]="item.icon" class="text-[15px]"></i>
              </button>
            </div>
          }
        } @else {
          @if (!layout.isSidebarCollapsed()) {
            <!-- Expanded leaf -->
            <button
              class="w-full flex items-center gap-2.5 px-2.5 py-1.75 rounded-md text-[13.5px] font-medium border-none cursor-pointer text-left transition-colors duration-150 relative overflow-hidden"
              [ngClass]="
                isItemActive(item)
                  ? 'bg-zinc-200 text-zinc-900 font-medium hover:bg-zinc-200'
                  : 'text-zinc-600 bg-transparent hover:bg-zinc-100 hover:text-zinc-900'
              "
              (click)="navigate(item)"
              pRipple
            >
              <i [class]="item.icon" class="text-[15px] w-4.5 text-center shrink-0"></i>
              <span class="flex-1 overflow-hidden text-ellipsis">{{ item.label }}</span>
            </button>
          } @else {
            <!-- Collapsed leaf — icon + tooltip -->
            <div class="flex justify-center w-full" [pTooltip]="item.label" tooltipPosition="right">
              <button
                class="flex items-center justify-center size-10 rounded-md border-none cursor-pointer transition-colors duration-150 relative overflow-hidden"
                [ngClass]="
                  isItemActive(item)
                    ? 'bg-zinc-200 text-zinc-900 hover:bg-zinc-200'
                    : 'bg-transparent text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900'
                "
                (click)="navigate(item)"
                pRipple
              >
                <i [class]="item.icon" class="text-[15px]"></i>
              </button>
            </div>
          }
        }
      }
    </nav>

    <!-- ── User Profile ── -->
    <div class="relative w-full shrink-0 border-t border-zinc-200">
      <button
        type="button"
        class="w-full flex items-center bg-transparent border-none cursor-pointer transition-colors duration-150 hover:bg-zinc-100"
        [class.gap-2.5]="!layout.isSidebarCollapsed()"
        [class.px-3.5]="!layout.isSidebarCollapsed()"
        [class.py-3.5]="!layout.isSidebarCollapsed()"
        [class.justify-center]="layout.isSidebarCollapsed()"
        [class.py-3]="layout.isSidebarCollapsed()"
        (click)="profileMenu.toggle($event)"
      >
        <p-avatar
          [label]="authState.userProfile()?.userName?.[0] || 'U'"
          shape="circle"
          styleClass="shrink-0 !bg-zinc-200 !text-zinc-900 font-semibold"
          [pTooltip]="
            layout.isSidebarCollapsed() ? authState.userProfile()?.userName || 'User' : ''
          "
          tooltipPosition="right"
        >
        </p-avatar>

        @if (!layout.isSidebarCollapsed()) {
          <div class="flex flex-col gap-0 min-w-0 overflow-hidden text-left flex-1">
            <span
              class="text-[13px] font-medium text-zinc-900 whitespace-nowrap overflow-hidden text-ellipsis"
              >{{ authState.userProfile()?.userName || 'User' }}</span
            >
            <span
              class="text-[11.5px] text-zinc-500 whitespace-nowrap overflow-hidden text-ellipsis"
              >{{ authState.userProfile()?.email || 'user@example.com' }}</span
            >
          </div>
          <i class="pi pi-chevron-up text-[10px] text-zinc-400 shrink-0 ml-1"></i>
        }
      </button>

      <p-menu
        class="px-10"
        #profileMenu
        [model]="profileMenuItems"
        [popup]="true"
        appendTo="body"
        styleClass="profile-menu-popup"
      ></p-menu>
    </div>
  </aside>

  <!-- ═══════════════ MAIN CONTENT ═══════════════ -->
  <main class="flex-1 flex flex-col min-w-0">
    <!-- Top Header — breadcrumb only -->
    <header class="h-16 flex items-center px-7 border-b border-zinc-200 bg-zinc-50 shrink-0">
      <p-breadcrumb
        class="flex-1"
        [model]="layout.breadcrumbs()"
        [home]="{ icon: 'pi pi-home', routerLink: '/' }"
      >
      </p-breadcrumb>
    </header>

    <!-- Page Content -->
    <div class="flex-1 overflow-y-auto bg-zinc-50 page-content">
      <div class="p-8 max-w-7xl mx-auto w-full">
        <router-outlet></router-outlet>
      </div>
    </div>
  </main>
</div>
